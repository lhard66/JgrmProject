<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="utf-8">
  <title>添加用户</title>
  <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.css">
  <script src="/node_modules/jquery/dist/jquery.js"></script>
  <script src="./layer/layer.js"></script>
  <script src="/node_modules/vue/dist/vue.js"></script>
  <style>
  .content {
    width: 550px;
    margin: 10px auto;
  }
  
  .btn-default {
    margin-right: 10px;
  }
  .glyphicon-warning{
  	color: red;
  }
  </style>
</head>

<body>
  <div class="content">
    <form class="form-horizontal" id="app">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">主要信息</h3>
        </div>
        <div class="panel-body">
          <div class="form-group">
            <label class="col-sm-3 control-label"><span class="glyphicon glyphicon-asterisk glyphicon-warning" aria-hidden="true"></span>用户名：</label>
            <div class="col-sm-9">
              <input type="text" class="form-control" v-model="form.name" @blur="checkName" placeholder="">
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label"><span class="glyphicon glyphicon-asterisk glyphicon-warning" aria-hidden="true"></span>密 码：</label>
            <div class="col-sm-9">
              <input type="password" class="form-control" v-model="form.pwd" placeholder="">
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label"><span class="glyphicon glyphicon-asterisk glyphicon-warning" aria-hidden="true"></span>确认密码：</label>
            <div class="col-sm-9">
              <input type="password" class="form-control" v-model="form.againPwd" placeholder="">
            </div>
          </div>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">用户信息</h3>
        </div>
        <div class="panel-body">
          <div class="form-group">
            <label class="col-sm-3 control-label">性别：</label>
            <div class="col-sm-9">
              <label class="radio-inline">
                <input type="radio" name="sex" id="inlineRadio1" v-model="form.sex">男
              </label>
              <label class="radio-inline">
                <input type="radio" name="sex" id="inlineRadio2" v-model="form.sex">女
              </label>
              <label class="radio-inline">
                <input type="radio" name="sex" id="inlineRadio3" v-model="form.sex">保密
              </label>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label">昵称：</label>
            <div class="col-sm-9">
              <input type="text" class="form-control" v-model="form.nick" placeholder="">
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label">电话：</label>
            <div class="col-sm-9">
              <input type="text" class="form-control" v-model="form.tel" placeholder="">
            </div>
          </div>
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-offset-3 col-sm-9">
          <a href="javascript:void(0);" class="btn btn-default" @click="confirm">确定</a>
          <span class="text-danger">{{warning}}</span>
        </div>
      </div>
    </form>
  </div>
  <script>
  var errorShow = function(msg) {
    layer.msg(msg, {
      icon: 2
    });
  }
  var exist = {
    wrong: 0,
    right: 1,
    existence: 2,
    error: 3,
  };
  var isExist = function(name) {
    var reg = /^[a-zA-Z0-9-_]{4,16}$/;
    if (name != '' && reg.test(name)) {
      $.get('/car-business/system/user/checkLoginName', {
        loginName: name
      }, function(res) {
        if (res == 'true') {
          return exist.right;
        } else {
          return exist.existence;
        }
      }).error(function() {
        return exist.error;
      })
    } else {
      return exist.wrong;
    }
  }
  var vm = new Vue({
    el: '#app',
    data: {
      loading: false,
      warning: '',
      exist: exist,
      form: {
        name: '',
        pwd: '',
        againPwd: '',
        nick: '',
        birthday: '',
        sex: null,
        email: '',
        tel: '',
        desc: '',
      }
    },
    methods: {
      confirm: function() {
        var form = this.form;
        if (form.pwd == '' && form.againPwd == '') {
          this.warning = '密码不能为空！';
          return
        } else {
          if (form.pwd != form.againPwd) {
            this.warning = '两次密码输入不一致！';
            return;
          }
        }
        this.warning = '';
        $.post('/adduser', $('form').serialize(), function(data) {
          console.log(data);
        }).error(function() {
          errorShow('网络异常，提交数据失败！');
        });
      },
      checkName: function() {
        var form = this.form;
        var status = isExist(form.name);
        if (status == form.right) {
          //加对号
          console.log('right');
        } else if (status == form.wrong) {
          //加错号
          console.log('wrong');
        } else {
          errorShow('网络异常！');
        }
      }
    }
  })
  </script>
</body>

</html>
